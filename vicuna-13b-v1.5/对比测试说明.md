# Vicuna-13B 基准对比测试说明

## 测试目的

对比 **未压缩的FP16模型** 和 **MI量化压缩模型** 的性能，评估压缩效果。

---

## 测试内容

### 1. 基准测试 (Baseline)
- **模型**: Vicuna-13B-v1.5 FP16 (未压缩)
- **精度**: 16-bit浮点数
- **稀疏度**: 0% (dense)
- **数据集**: WikiText2, PTB, C4

### 2. 压缩模型测试 (Compressed)
- **模型**: Vicuna-13B-v1.5 MI量化
- **精度**: 混合精度 (2/3/4/6/8-bit)
- **稀疏度**: 50%
- **方法**: 互信息分组 + 自适应量化 + 剪枝
- **数据集**: WikiText2, PTB, C4

---

## 已完成的测试

### ✅ 压缩模型测试
- **状态**: 已完成
- **日志**: `test_fix.log`
- **结果**:
  - WikiText2 PPL: 7.17
  - PTB PPL: 73.87
  - C4 PPL: 10.29
  - 平均比特数: 7.88 bits
  - 总耗时: 2533秒 (~42分钟)

### 🔄 基准模型测试
- **状态**: 正在运行
- **脚本**: `./test_baseline.sh`
- **日志**: `baseline_test.log`
- **预计时间**: 5-10分钟

---

## 监控进度

### 检查测试进度
```bash
./check_baseline_progress.sh
```

### 实时查看日志
```bash
tail -f baseline_test.log
```

### 查看GPU使用
```bash
nvidia-smi -l 1  # 每秒刷新一次
```

---

## 对比分析

### 等基准测试完成后运行：

```bash
python compare_results.py
```

这将生成详细的对比报告，包括：

1. **模型配置对比**
   - 精度、稀疏度、压缩方法

2. **困惑度对比**
   - 各数据集的PPL
   - 性能保持率
   - 变化百分比

3. **压缩效果分析**
   - 压缩率计算
   - 比特分配分布
   - 实际vs目标对比

4. **计算开销对比**
   - 评估时间
   - 压缩时间

5. **总体评价**
   - 综合评分
   - 优缺点分析

6. **改进建议**
   - 针对性的优化建议

---

## 文件说明

### 测试脚本
- `test_baseline.sh` - 基准测试运行脚本
- `test_baseline.py` - 基准测试Python代码
- `vicuna_mi.py` - MI量化测试代码

### 日志文件
- `baseline_test.log` - 基准测试日志
- `test_fix.log` - MI量化测试日志

### 结果文件
- `baseline_results.json` - 基准测试结果
- `comparison_results.json` - 对比分析结果

### 分析脚本
- `compare_results.py` - 对比分析脚本
- `check_baseline_progress.sh` - 进度检查脚本

### 报告文档
- `测试结果分析.md` - MI量化详细分析
- `测试结果摘要.txt` - MI量化快速摘要

---

## 预期结果

### 理想情况
- **压缩率**: 4-8x (相对于FP16)
- **性能保持率**: >90% (WikiText2, C4)
- **模型大小**: 原始的 12.5% - 25%

### 实际观察
根据已有的MI量化测试结果：
- 实际平均位宽: 7.88 bits (vs 目标 4.0 bits)
- 比特分配偏保守: 93% 通道使用 8-bit
- WikiText2性能优秀: PPL 7.17
- C4性能良好: PPL 10.29
- PTB性能较差: PPL 73.87

### 关键问题
1. **比特分配策略过于保守** - 需要优化
2. **实际压缩率低于目标** - 需要调整阈值
3. **PTB性能下降明显** - 可能需要改进校准策略

---

## 下一步行动

### 1. 等待基准测试完成
预计 5-10 分钟

### 2. 运行对比分析
```bash
python compare_results.py
```

### 3. 根据对比结果优化
- 调整比特分配阈值
- 增加校准样本数
- 优化分组策略

### 4. 重新测试
使用优化后的参数重新运行MI量化测试

---

## 快速命令参考

```bash
# 检查进度
./check_baseline_progress.sh

# 查看日志
tail -f baseline_test.log

# 对比结果 (基准测试完成后)
python compare_results.py

# 查看GPU
nvidia-smi

# 停止测试 (如果需要)
pkill -f test_baseline.py
```

---

## 技术细节

### 基准模型特征
- **参数量**: ~13B
- **架构**: LLaMA
- **层数**: 40层
- **隐藏维度**: 5120
- **FFN维度**: 13824
- **注意力头数**: 40
- **序列长度**: 4096

### 压缩配置
- **稀疏度**: 50% (sparsity=0.5)
- **基础量化**: 4-bit (wbits=4)
- **目标平均位宽**: 4.0 bits
- **MI分组数**: 5 groups
- **校准样本**: 16 samples

---

## 参考文档

- **详细分析**: `测试结果分析.md`
- **快速摘要**: `测试结果摘要.txt`
- **Bug修复**: `BUG修复完整记录.md`
- **使用说明**: `README.md`

---

**最后更新**: 2025-10-17
**状态**: 基准测试运行中，等待完成后进行对比分析

