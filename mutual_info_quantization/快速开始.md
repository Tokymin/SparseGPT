# åŸºäºäº’ä¿¡æ¯çš„é‡åŒ–åˆ†ç»„ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### æ­¥éª¤1: æŸ¥çœ‹é¡¹ç›®è¯´æ˜

```bash
cd /media/user/data3/toky/Projects/SparseGPT/mutual_info_quantization
cat README.md
```

### æ­¥éª¤2: é˜…è¯»å¯è¡Œæ€§è¯„ä¼°ï¼ˆé‡è¦ï¼ï¼‰

```bash
cat æ”¹è¿›æ–¹æ¡ˆè¯„ä¼°.md
```

**å…³é”®ç»“è®º**: 
- âœ… ç†è®ºé è°±ï¼ˆ9/10åˆ†ï¼‰
- âœ… é¢„æœŸæå‡3-7%
- âœ… å¼ºçƒˆæ¨èå®æ–½

### æ­¥éª¤3: è¿è¡Œå¿«é€Ÿæµ‹è¯•

```bash
chmod +x test_mi.sh
./test_mi.sh
```

**æµ‹è¯•å†…å®¹**:
1. åŸç‰ˆSparseGPTï¼ˆåŸºå‡†ï¼‰
2. å¢å¼ºç‰ˆï¼ˆæ— MIåˆ†ç»„ï¼‰
3. MIæ”¹è¿›ç‰ˆï¼ˆäº’ä¿¡æ¯åˆ†ç»„ï¼‰

**é¢„è®¡æ—¶é—´**: çº¦20-30åˆ†é’Ÿ

### æ­¥éª¤4: æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹æµ‹è¯•æ—¥å¿—
ls test_results/

# å¯¹æ¯”PPLç»“æœ
cat test_results/baseline_original.log | grep "Perplexity on"
cat test_results/enhanced_no_mi.log | grep "Perplexity on"
cat test_results/mi_enhanced.log | grep "Perplexity on"
```

---

## ğŸ“ æ–‡ä»¶å¯¼èˆª

### å¿…è¯»æ–‡æ¡£

1. **æ”¹è¿›æ–¹æ¡ˆè¯„ä¼°.md** â­â­â­
   - å¯è¡Œæ€§åˆ†æ
   - é¢„æœŸæ•ˆæœ
   - æŒ‘æˆ˜ä¸åº”å¯¹

2. **é¡¹ç›®æ€»ç»“.md** â­â­
   - æŠ€æœ¯å®ç°
   - ä½¿ç”¨æŒ‡å—
   - å®éªŒè®¡åˆ’

3. **README.md** â­
   - é¡¹ç›®æ¦‚è¿°
   - æ–‡ä»¶ç»“æ„

### æ ¸å¿ƒä»£ç 

1. **mutual_info.py**
   - äº’ä¿¡æ¯è®¡ç®—
   - å¿«é€Ÿ/ç²¾ç¡®æ–¹æ³•
   - æˆå¯¹MIçŸ©é˜µ

2. **channel_grouping.py**
   - è°±èšç±»/å±‚æ¬¡èšç±»
   - è‡ªåŠ¨é€‰æ‹©åˆ†ç»„æ•°
   - æ¯”ç‰¹åˆ†é…ç­–ç•¥

3. **sparsegpt_mi.py**
   - MIé‡åŒ–SparseGPT
   - é›†æˆMIåˆ†ç»„
   - ç»Ÿè®¡æ”¶é›†

4. **opt_mi.py**
   - OPTæ¨¡å‹æµ‹è¯•
   - é€å±‚å¤„ç†
   - æ€§èƒ½è¯„ä¼°

### æµ‹è¯•è„šæœ¬

1. **test_mi.sh**
   - å¿«é€Ÿå¯¹æ¯”æµ‹è¯•
   - è‡ªåŠ¨ç»“æœæå–

---

## ğŸ¯ æ ¸å¿ƒæ€æƒ³ï¼ˆ30ç§’ç†è§£ï¼‰

**é—®é¢˜**: å½“å‰æ–¹æ³•æ¯ä¸ªé€šé“ç‹¬ç«‹é‡åŒ–ï¼Œå¿½ç•¥äº†é€šé“é—´çš„ç›¸å…³æ€§

**è§£å†³**: 
```
1. è®¡ç®—äº’ä¿¡æ¯ â†’ å‘ç°ç›¸å…³é€šé“
2. æ™ºèƒ½åˆ†ç»„    â†’ ç›¸å…³é€šé“åˆ†ä¸€ç»„
3. å·®å¼‚åŒ–é‡åŒ–  â†’ å†—ä½™ç»„ä½æ¯”ç‰¹ï¼Œç‹¬ç«‹ç»„é«˜æ¯”ç‰¹
```

**æ•ˆæœ**: åœ¨ç›¸åŒæ¯”ç‰¹é¢„ç®—ä¸‹ï¼Œæ€§èƒ½æ›´å¥½ï¼

---

## ğŸ“Š é¢„æœŸç»“æœ

åŸºäº opt-125m, sp=0.5, 4bit avg:

| æ–¹æ³• | WikiText2 PPL | æ”¹è¿› |
|------|---------------|------|
| åŸç‰ˆ | 39.109 | åŸºå‡† |
| å¢å¼ºç‰ˆ | 36.186 | -7.5% âœ… |
| **MIæ”¹è¿›ç‰ˆ** | **~35.0** | **~10%** âœ…âœ… |

---

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•

### åŸºç¡€ç”¨æ³•

```bash
python opt_mi.py facebook/opt-125m c4 \
    --sparsity 0.5 \
    --wbits 4 \
    --target_avg_bits 4.0 \
    --use_mi_grouping 1 \
    --n_groups 10
```

### å‚æ•°è°ƒæ•´

**åˆ†ç»„æ•°é‡**:
```bash
--n_groups 5   # å°‘åˆ†ç»„ï¼ˆç²—ç²’åº¦ï¼‰
--n_groups 20  # å¤šåˆ†ç»„ï¼ˆç»†ç²’åº¦ï¼‰
--n_groups 50  # å¾ˆå¤šåˆ†ç»„
```

**ç›®æ ‡æ¯”ç‰¹æ•°**:
```bash
--target_avg_bits 3.0  # æ›´æ¿€è¿›å‹ç¼©
--target_avg_bits 4.0  # å¹³è¡¡
--target_avg_bits 5.0  # ä¿å®ˆå‹ç¼©
```

**ç¨€ç–åº¦**:
```bash
--sparsity 0.3  # 30%ç¨€ç–
--sparsity 0.5  # 50%ç¨€ç–
--sparsity 0.7  # 70%ç¨€ç–
```

**å¼€å¯/å…³é—­MIåˆ†ç»„**:
```bash
--use_mi_grouping 1  # ä½¿ç”¨MIåˆ†ç»„
--use_mi_grouping 0  # ä¸ä½¿ç”¨ï¼ˆå¯¹æ¯”åŸºå‡†ï¼‰
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: å¯¼å…¥é”™è¯¯

```bash
ModuleNotFoundError: No module named 'sklearn'
```

**è§£å†³**:
```bash
pip install scikit-learn
```

### é—®é¢˜2: å†…å­˜ä¸è¶³

**è§£å†³**:
- å‡å°‘é‡‡æ ·æ•°: `--nsamples 64`
- ä½¿ç”¨æ›´å°æ¨¡å‹: `facebook/opt-125m`

### é—®é¢˜3: GPUä¸å¯ç”¨

**è§£å†³**:
```bash
export CUDA_VISIBLE_DEVICES=2,3
nvidia-smi  # æ£€æŸ¥GPUçŠ¶æ€
```

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥

### 1. è¿è¡ŒåŸºç¡€æµ‹è¯• âœ…
```bash
./test_mi.sh
```

### 2. åˆ†æç»“æœ âœ…
- å¯¹æ¯”PPL
- æŸ¥çœ‹åˆ†ç»„ç»Ÿè®¡
- è¯„ä¼°è®¡ç®—æ—¶é—´

### 3. å‚æ•°ä¼˜åŒ– â­
- æµ‹è¯•ä¸åŒKå€¼
- è°ƒæ•´æ¯”ç‰¹åˆ†é…
- ä¼˜åŒ–MIè®¡ç®—æ–¹æ³•

### 4. æ‰©å±•å®éªŒ â­
- æ›´å¤§æ¨¡å‹
- å¤šæ•°æ®é›†
- æ¶ˆèå®éªŒ

### 5. æ’°å†™è®ºæ–‡ â­
- å®Œæ•´å®éªŒ
- å¯è§†åŒ–åˆ†æ
- ç†è®ºè¯æ˜

---

## ğŸ’¡ å…³é”®å‘½ä»¤é€ŸæŸ¥

```bash
# å¿«é€Ÿæµ‹è¯•
./test_mi.sh

# æŸ¥çœ‹ç»“æœ
cat test_results/*.log | grep "Perplexity"

# è‡ªå®šä¹‰æµ‹è¯•ï¼ˆMIåˆ†ç»„ï¼‰
python opt_mi.py facebook/opt-125m c4 \
    --sparsity 0.5 --wbits 4 \
    --target_avg_bits 4.0 \
    --use_mi_grouping 1 --n_groups 10

# å¯¹æ¯”åŸºå‡†ï¼ˆæ— MIåˆ†ç»„ï¼‰
python opt_mi.py facebook/opt-125m c4 \
    --sparsity 0.5 --wbits 4 \
    --target_avg_bits 4.0 \
    --use_mi_grouping 0

# æµ‹è¯•äº’ä¿¡æ¯è®¡ç®—
python mutual_info.py

# æµ‹è¯•é€šé“åˆ†ç»„
python channel_grouping.py
```

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹å‰ï¼Œç¡®ä¿ï¼š

- [ ] GPUå¯ç”¨ï¼ˆ12GB+ VRAMï¼‰
- [ ] Pythonç¯å¢ƒæ­£ç¡®
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆscikit-learn, scipyç­‰ï¼‰
- [ ] å·²é˜…è¯»å¯è¡Œæ€§è¯„ä¼°æ–‡æ¡£
- [ ] ç†è§£æ ¸å¿ƒæ€æƒ³

è¿è¡Œæµ‹è¯•åï¼Œæ£€æŸ¥ï¼š

- [ ] ä¸‰ä¸ªæ–¹æ³•éƒ½è¿è¡ŒæˆåŠŸ
- [ ] PPLç»“æœå·²æå–
- [ ] MIæ”¹è¿›ç‰ˆä¼˜äºåŸºå‡†
- [ ] æŸ¥çœ‹åˆ†ç»„ç»Ÿè®¡ä¿¡æ¯
- [ ] è®¡ç®—æ—¶é—´å¯æ¥å—

---

## ğŸ“ å­¦ä¹ è·¯å¾„

**æ–°æ‰‹** (ç¬¬1å¤©):
1. é˜…è¯»README
2. è¿è¡Œtest_mi.sh
3. ç†è§£æ ¸å¿ƒæ€æƒ³

**è¿›é˜¶** (ç¬¬2-3å¤©):
1. é˜…è¯»ä»£ç å®ç°
2. è°ƒæ•´å‚æ•°æµ‹è¯•
3. åˆ†æMIçŸ©é˜µ

**ä¸“å®¶** (ç¬¬4-7å¤©):
1. å¤šé…ç½®å®éªŒ
2. å¯è§†åŒ–åˆ†æ
3. æ¶ˆèå®éªŒ

---

**ç°åœ¨å°±å¼€å§‹å§ï¼** ğŸš€

```bash
cd /media/user/data3/toky/Projects/SparseGPT/mutual_info_quantization
./test_mi.sh
```

