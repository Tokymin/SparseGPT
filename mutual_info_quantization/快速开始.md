# 基于互信息的量化分组 - 快速开始指南

## 🚀 5分钟快速上手

### 步骤1: 查看项目说明

```bash
cd /media/user/data3/toky/Projects/SparseGPT/mutual_info_quantization
cat README.md
```

### 步骤2: 阅读可行性评估（重要！）

```bash
cat 改进方案评估.md
```

**关键结论**: 
- ✅ 理论靠谱（9/10分）
- ✅ 预期提升3-7%
- ✅ 强烈推荐实施

### 步骤3: 运行快速测试

```bash
chmod +x test_mi.sh
./test_mi.sh
```

**测试内容**:
1. 原版SparseGPT（基准）
2. 增强版（无MI分组）
3. MI改进版（互信息分组）

**预计时间**: 约20-30分钟

### 步骤4: 查看结果

```bash
# 查看测试日志
ls test_results/

# 对比PPL结果
cat test_results/baseline_original.log | grep "Perplexity on"
cat test_results/enhanced_no_mi.log | grep "Perplexity on"
cat test_results/mi_enhanced.log | grep "Perplexity on"
```

---

## 📁 文件导航

### 必读文档

1. **改进方案评估.md** ⭐⭐⭐
   - 可行性分析
   - 预期效果
   - 挑战与应对

2. **项目总结.md** ⭐⭐
   - 技术实现
   - 使用指南
   - 实验计划

3. **README.md** ⭐
   - 项目概述
   - 文件结构

### 核心代码

1. **mutual_info.py**
   - 互信息计算
   - 快速/精确方法
   - 成对MI矩阵

2. **channel_grouping.py**
   - 谱聚类/层次聚类
   - 自动选择分组数
   - 比特分配策略

3. **sparsegpt_mi.py**
   - MI量化SparseGPT
   - 集成MI分组
   - 统计收集

4. **opt_mi.py**
   - OPT模型测试
   - 逐层处理
   - 性能评估

### 测试脚本

1. **test_mi.sh**
   - 快速对比测试
   - 自动结果提取

---

## 🎯 核心思想（30秒理解）

**问题**: 当前方法每个通道独立量化，忽略了通道间的相关性

**解决**: 
```
1. 计算互信息 → 发现相关通道
2. 智能分组    → 相关通道分一组
3. 差异化量化  → 冗余组低比特，独立组高比特
```

**效果**: 在相同比特预算下，性能更好！

---

## 📊 预期结果

基于 opt-125m, sp=0.5, 4bit avg:

| 方法 | WikiText2 PPL | 改进 |
|------|---------------|------|
| 原版 | 39.109 | 基准 |
| 增强版 | 36.186 | -7.5% ✅ |
| **MI改进版** | **~35.0** | **~10%** ✅✅ |

---

## 🔧 自定义测试

### 基础用法

```bash
python opt_mi.py facebook/opt-125m c4 \
    --sparsity 0.5 \
    --wbits 4 \
    --target_avg_bits 4.0 \
    --use_mi_grouping 1 \
    --n_groups 10
```

### 参数调整

**分组数量**:
```bash
--n_groups 5   # 少分组（粗粒度）
--n_groups 20  # 多分组（细粒度）
--n_groups 50  # 很多分组
```

**目标比特数**:
```bash
--target_avg_bits 3.0  # 更激进压缩
--target_avg_bits 4.0  # 平衡
--target_avg_bits 5.0  # 保守压缩
```

**稀疏度**:
```bash
--sparsity 0.3  # 30%稀疏
--sparsity 0.5  # 50%稀疏
--sparsity 0.7  # 70%稀疏
```

**开启/关闭MI分组**:
```bash
--use_mi_grouping 1  # 使用MI分组
--use_mi_grouping 0  # 不使用（对比基准）
```

---

## 🐛 故障排查

### 问题1: 导入错误

```bash
ModuleNotFoundError: No module named 'sklearn'
```

**解决**:
```bash
pip install scikit-learn
```

### 问题2: 内存不足

**解决**:
- 减少采样数: `--nsamples 64`
- 使用更小模型: `facebook/opt-125m`

### 问题3: GPU不可用

**解决**:
```bash
export CUDA_VISIBLE_DEVICES=2,3
nvidia-smi  # 检查GPU状态
```

---

## 📈 下一步

### 1. 运行基础测试 ✅
```bash
./test_mi.sh
```

### 2. 分析结果 ✅
- 对比PPL
- 查看分组统计
- 评估计算时间

### 3. 参数优化 ⏭
- 测试不同K值
- 调整比特分配
- 优化MI计算方法

### 4. 扩展实验 ⏭
- 更大模型
- 多数据集
- 消融实验

### 5. 撰写论文 ⏭
- 完整实验
- 可视化分析
- 理论证明

---

## 💡 关键命令速查

```bash
# 快速测试
./test_mi.sh

# 查看结果
cat test_results/*.log | grep "Perplexity"

# 自定义测试（MI分组）
python opt_mi.py facebook/opt-125m c4 \
    --sparsity 0.5 --wbits 4 \
    --target_avg_bits 4.0 \
    --use_mi_grouping 1 --n_groups 10

# 对比基准（无MI分组）
python opt_mi.py facebook/opt-125m c4 \
    --sparsity 0.5 --wbits 4 \
    --target_avg_bits 4.0 \
    --use_mi_grouping 0

# 测试互信息计算
python mutual_info.py

# 测试通道分组
python channel_grouping.py
```

---

## ✅ 检查清单

在开始前，确保：

- [ ] GPU可用（12GB+ VRAM）
- [ ] Python环境正确
- [ ] 依赖已安装（scikit-learn, scipy等）
- [ ] 已阅读可行性评估文档
- [ ] 理解核心思想

运行测试后，检查：

- [ ] 三个方法都运行成功
- [ ] PPL结果已提取
- [ ] MI改进版优于基准
- [ ] 查看分组统计信息
- [ ] 计算时间可接受

---

## 🎓 学习路径

**新手** (第1天):
1. 阅读README
2. 运行test_mi.sh
3. 理解核心思想

**进阶** (第2-3天):
1. 阅读代码实现
2. 调整参数测试
3. 分析MI矩阵

**专家** (第4-7天):
1. 多配置实验
2. 可视化分析
3. 消融实验

---

**现在就开始吧！** 🚀

```bash
cd /media/user/data3/toky/Projects/SparseGPT/mutual_info_quantization
./test_mi.sh
```

